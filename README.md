
# PSI Algorithmï¼šåŸºäºFringeç´¢å¼•çš„Zernikeæ‹Ÿåˆå…¨æµç¨‹

![Static Badge](https://img.shields.io/badge/python-3.13-green)
![Static Badge](https://img.shields.io/badge/license-MIT-orange)


åŸºäº **Fringeç´¢å¼•è§„åˆ™** çš„Zernikeå¤šé¡¹å¼å®ç°å…‰å­¦å¹²æ¶‰æµ‹é‡å…¨æµç¨‹ï¼šå¹²æ¶‰å›¾ä»¿çœŸ â†’ ç›¸ä½æå– â†’ ç›¸ä½è§£åŒ…è£¹ â†’ Zernikeå¤šé¡¹å¼æ‹Ÿåˆï¼Œé€‚ç”¨äºå…‰å­¦å¹²æ¶‰ç®—æ³•éªŒè¯ã€Zernikeå¤šé¡¹å¼å­¦ä¹ ä¸ç ”ç©¶ã€‚

## ğŸ“– é¡¹ç›®ä»‹ç»

æœ¬é¡¹ç›®å›´ç»•**Fringeç´¢å¼•**ï¼ˆåŒºåˆ«äºä¼ ç»ŸANSI Zernikeç´¢å¼•ï¼‰çš„Zernikeå¤šé¡¹å¼å±•å¼€ï¼Œå®ç°äº†ä»å¹²æ¶‰å›¾ä»¿çœŸåˆ°Zernikeæ‹Ÿåˆçš„ç«¯åˆ°ç«¯æµç¨‹ï¼š

1. ç»Ÿä¸€ç½‘æ ¼/æåæ ‡/åœ†å½¢æ©ç ç”Ÿæˆï¼Œé¿å…å¤šæ¨¡å—æå¾„å¤„ç†ä¸ä¸€è‡´é—®é¢˜ï¼›

2. è‡ªåŠ¨ç”ŸæˆFringeç´¢å¼•çš„Zernikeå¤šé¡¹å¼ï¼ˆå«æ­£äº¤å½’ä¸€åŒ–ï¼‰ï¼Œæ”¯æŒè¡¨è¾¾å¼æ‰“å°ã€å¯è§†åŒ–ï¼›

3. ä»¿çœŸå¸¦å™ªå£°çš„å¤šæ­¥ç›¸ç§»å¹²æ¶‰å›¾ï¼ˆæ”¯æŒ4æ­¥ç›¸ç§»ï¼‰ï¼›

4. åŸºäºç›¸ç§»ç®—æ³•æå–åŒ…è£¹ç›¸ä½ï¼Œé€šè¿‡åŒºåŸŸå¢é•¿æ³•è§£åŒ…è£¹ï¼›

5. æœ€å°äºŒä¹˜æ‹ŸåˆZernikeç³»æ•°ï¼Œé‡åŒ–å¯¹æ¯”çœŸå®/æ‹Ÿåˆç›¸ä½ä¸ç³»æ•°ï¼›

6. å…¨æµç¨‹å¯è§†åŒ–ï¼Œç›´è§‚å±•ç¤ºæ¯ä¸€æ­¥ç»“æœã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **é²æ£’çš„ç½‘æ ¼å¤„ç†**ï¼šå°è£…`GridGenerator`ç±»ï¼Œç»Ÿä¸€ç®¡ç†ç¬›å¡å°”/æåæ ‡ç½‘æ ¼ã€å•ä½åœ†æ©ç ï¼Œé¿å…æ‰‹åŠ¨ä¿®æ”¹æå¾„å¯¼è‡´çš„é€»è¾‘é”™è¯¯ï¼›

- **æ ‡å‡†Zernikeå®ç°**ï¼šä¸¥æ ¼éµå¾ªFringeç´¢å¼•è§„åˆ™ï¼Œæ”¯æŒZernikeå¤šé¡¹å¼è¡¨è¾¾å¼è‡ªåŠ¨ç”Ÿæˆã€æ­£äº¤å½’ä¸€åŒ–ï¼›

- **é«˜ä¿çœŸä»¿çœŸ**ï¼šæ”¯æŒæ·»åŠ é«˜æ–¯å™ªå£°ã€è°ƒåˆ¶æ·±åº¦é…ç½®ï¼Œæ¨¡æ‹ŸçœŸå®å¹²æ¶‰å›¾ç‰¹æ€§ï¼›

- **å®Œæ•´æµç¨‹éªŒè¯**ï¼šä»å¹²æ¶‰å›¾ä»¿çœŸåˆ°æ‹Ÿåˆç»“æœé‡åŒ–ï¼Œå…¨æµç¨‹è‡ªéªŒè¯ï¼Œä¾¿äºç®—æ³•è°ƒè¯•ï¼›

- **å‹å¥½çš„å¯è§†åŒ–**ï¼šæä¾›å¹²æ¶‰å›¾ã€åŒ…è£¹/è§£åŒ…è£¹ç›¸ä½ã€çœŸå®/æ‹Ÿåˆç›¸ä½ã€ç³»æ•°å¯¹æ¯”ç­‰å¤šç»´åº¦å¯è§†åŒ–ã€‚

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### ä¾èµ–åº“

```Plain Text

numpy >= 1.21.0
scipy >= 1.7.0
matplotlib >= 3.4.0
```

### å®‰è£…æ–¹å¼

```Bash

# å…‹éš†ä»“åº“
git clone https://github.com/seatonyang/PSI-Algorithm.git
cd PSI-Algorithm

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
# æˆ–æ‰‹åŠ¨å®‰è£…
pip install numpy scipy matplotlib
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå®Œæ•´æµç¨‹

```Bash

# è¿è¡Œä¸»ç¨‹åºï¼ˆå«ä»¿çœŸâ†’æå–â†’è§£åŒ…è£¹â†’æ‹Ÿåˆâ†’å¯è§†åŒ–ï¼‰
python main.py
```

### æ ¸å¿ƒåŠŸèƒ½ç¤ºä¾‹

#### 1. ç”Ÿæˆç»Ÿä¸€ç½‘æ ¼

```Python

from grid_utils import GridGenerator

# ç”Ÿæˆ512Ã—512ç½‘æ ¼ï¼ˆ-1~1ç¬›å¡å°”åæ ‡ï¼Œ0~âˆš2æå¾„ï¼‰
grid = GridGenerator(size=512)
print(f"ç½‘æ ¼å°ºå¯¸ï¼š{grid.size}Ã—{grid.size}")
print(f"å•ä½åœ†æœ‰æ•ˆåƒç´ æ•°ï¼š{np.sum(grid.circle_mask)}")
```

#### 2. ç”ŸæˆFringe Zernikeå¤šé¡¹å¼

```Python

from fringe_zernike_generator import FringeZernike

# åˆå§‹åŒ–Zernikeç”Ÿæˆå™¨ï¼ˆ8é˜¶ï¼ŒåŸºäºç»Ÿä¸€ç½‘æ ¼ï¼‰
zernike_gen = FringeZernike(max_order=8, grid=grid)

# ç”Ÿæˆç¬¬4é˜¶ï¼ˆFocusï¼‰å¤šé¡¹å¼
z4 = zernike_gen.generate(4)
# æ‰“å°å¤šé¡¹å¼è¡¨è¾¾å¼
zernike_gen.print_zernike_expression(index=4)
# å¯è§†åŒ–å•ä¸ªå¤šé¡¹å¼
zernike_gen.plot_single(index=4, cmap="jet")
```

#### 3. ä»¿çœŸç›¸ç§»å¹²æ¶‰å›¾

```Python

from interferogram_simulation import InterferogramSimulator
import numpy as np

# é…ç½®çœŸå®Zernikeç³»æ•°ï¼ˆ8é˜¶ï¼‰
true_coeffs = np.zeros(8)
true_coeffs[1] = 0.6  # Tilt x
true_coeffs[3] = 1.2  # Focus
true_coeffs[4] = 0.9  # Astigmatism x

# 4æ­¥ç›¸ç§»é‡
phase_shifts = [0, np.pi/2, np.pi, 3*np.pi/2]

# åˆå§‹åŒ–ä»¿çœŸå™¨
simulator = InterferogramSimulator(
    grid=grid,
    max_order=8,
    true_coeffs=true_coeffs,
    phase_shifts=phase_shifts,
    noise_std=0.03  # é«˜æ–¯å™ªå£°æ ‡å‡†å·®
)

# ç”Ÿæˆå¹²æ¶‰å›¾å’ŒçœŸå®ç›¸ä½
interferograms, true_phase = simulator.generate()
print(f"å¹²æ¶‰å›¾å½¢çŠ¶ï¼š{interferograms.shape}")  # (4, 512, 512)
```

#### 4. Zernikeå¤šé¡¹å¼æ‹Ÿåˆ

```Python

from zernike_fitting import ZernikeFitter

# åˆå§‹åŒ–æ‹Ÿåˆå™¨ï¼ˆåŸºäºè§£åŒ…è£¹ç›¸ä½ï¼‰
fitter = ZernikeFitter(
    grid=grid,
    unwrapped_phase=unwrapped_phase,  # è§£åŒ…è£¹åçš„ç›¸ä½
    max_order=8
)

# æœ€å°äºŒä¹˜æ‹Ÿåˆ
fitted_coeffs, fitted_phase = fitter.fit()

# æ‰“å°æ‹Ÿåˆç»“æœ
coeff_rmse = np.sqrt(np.mean((true_coeffs - fitted_coeffs)**2))
phase_rmse = np.sqrt(np.nanmean((true_phase - fitted_phase)**2))
print(f"ç³»æ•°æ‹ŸåˆRMSEï¼š{coeff_rmse:.6f}")
print(f"ç›¸ä½æ‹ŸåˆRMSEï¼š{phase_rmse:.6f}")
```

## ğŸ“‚ ä»£ç ç»“æ„

|æ–‡ä»¶|æ ¸å¿ƒåŠŸèƒ½|
|---|---|
|`grid_utils.py`|ç»Ÿä¸€ç½‘æ ¼ç”Ÿæˆå·¥å…·ï¼šç¬›å¡å°”/æåæ ‡ç½‘æ ¼ã€å•ä½åœ†æ©ç ã€ç›¸ä½æ ‡å‡†åŒ–|
|`fringe_zernike_generator.py`|Fringe Zernikeå¤šé¡¹å¼ç”Ÿæˆï¼šç´¢å¼•æ˜ å°„ã€å¾„å‘/è§’å‘å¤šé¡¹å¼ã€å¯è§†åŒ–ã€è¡¨è¾¾å¼æ‰“å°|
|`interferogram_simulation.py`|ç›¸ç§»å¹²æ¶‰å›¾ä»¿çœŸï¼šåŸºäºZernikeç›¸ä½ç”Ÿæˆå¸¦å™ªå£°çš„å¹²æ¶‰å›¾|
|`phase_extraction.py`|ç›¸ä½æå–ï¼šä»ç›¸ç§»å¹²æ¶‰å›¾ä¸­æå–åŒ…è£¹ç›¸ä½|
|`phase_unwrapping.py`|ç›¸ä½è§£åŒ…è£¹ï¼šåŒºåŸŸå¢é•¿æ³•è§£åŒ…è£¹ï¼Œæ¢å¤è¿ç»­ç›¸ä½|
|`zernike_fitting.py`|Zernikeæ‹Ÿåˆï¼šæœ€å°äºŒä¹˜æ‹ŸåˆZernikeç³»æ•°ï¼Œç”Ÿæˆæ‹Ÿåˆç›¸ä½|
|`main.py`|ä¸»ç¨‹åºï¼šä¸²è”å…¨æµç¨‹ï¼ˆä»¿çœŸâ†’æå–â†’è§£åŒ…è£¹â†’æ‹Ÿåˆâ†’å¯è§†åŒ–ï¼‰|
|`requirements.txt`|ä¾èµ–åº“æ¸…å•|
## ğŸ“Š ç»“æœå±•ç¤º

### 1. å•ä½åœ†æ©ç 
![circle mask](docs/images/circle_mask.png)


### 2. 4æ­¥ç›¸ç§»å¹²æ¶‰å›¾

![simulation_interferograms](docs/images/simulation_interferograms.png)

### 3. åŒ…è£¹/è§£åŒ…è£¹ç›¸ä½

![phase_extraction_and_unwrapping](docs/images/phase_extraction_and_unwrapping.png)

### 4. Zernikeæ‹Ÿåˆç»“æœ

![zernike_fitting](docs/images/zernike_fitting.png)


## ğŸ¯ æ ¸å¿ƒåŸç†

### 1. Fringe Zernikeç´¢å¼•è§„åˆ™

Fringeç´¢å¼•æŒ‰`s = m + k`åˆ†ç»„ï¼ˆ`m`ä¸ºè§’å‘é˜¶æ•°ï¼Œ`k`ä¸ºå¾„å‘å­é˜¶æ•°ï¼‰ï¼Œæ¯ç»„å†…æŒ‰`m`é€’å‡æ’åˆ—ï¼Œ`m=0`æ—¶ä¸ºçº¯å¾„å‘é¡¹ï¼Œ`mâ‰ 0`æ—¶åˆ†ä¸º`cos(mÎ¸)`ï¼ˆxå‘ï¼‰å’Œ`sin(mÎ¸)`ï¼ˆyå‘ï¼‰é¡¹ã€‚

### 2. Zernikeå¤šé¡¹å¼å®šä¹‰

 $Z_n^m(r,Î¸) = R_n^m(r) Ã— \begin{cases} 1 & (m=0) \\ \cos(mÎ¸) & (m>0, \text{cosé¡¹}) \\ \sin(mÎ¸) & (m>0, \text{siné¡¹}) \end{cases} $ 

å…¶ä¸­å¾„å‘å¤šé¡¹å¼ $R_n^m(r)$ æ»¡è¶³ï¼š

 $R_n^m(r) = \sum_{s=0}^{(n-m)/2} \frac{(-1)^s (n-s)!}{s! \left(\frac{n+m}{2}-s\right)! \left(\frac{n-m}{2}-s\right)!} r^{n-2s} $ 

### 3. ç›¸ç§»å¹²æ¶‰æœ¯åŸç†

4æ­¥ç›¸ç§»å¹²æ¶‰å›¾çš„å…‰å¼ºåˆ†å¸ƒï¼š

 $I_i = I_0 \left[1 + \gamma \cos(\phi + \delta_i)\right] $ 

å…¶ä¸­ $\phi$ ä¸ºå¾…æµ‹ç›¸ä½ï¼Œ $\delta_i$ ä¸ºç›¸ç§»é‡ï¼Œé€šè¿‡4æ­¥ç›¸ç§»ç®—æ³•æå–ç›¸ä½ï¼š

 $\phi = \arctan\left(\frac{I_4 - I_2}{I_1 - I_3}\right) $ 

### 4. æœ€å°äºŒä¹˜æ‹Ÿåˆ

å°†è§£åŒ…è£¹ç›¸ä½åˆ†è§£ä¸ºZernikeåŸºçš„çº¿æ€§ç»„åˆï¼š

 $\phi(r,Î¸) = \sum_{i=1}^N c_i Z_i(r,Î¸) $ 

é€šè¿‡æœ€å°äºŒä¹˜æ±‚è§£ç³»æ•° $c_i$ ï¼š

 $\hat{c} = \arg\min_c \| \phi - AZ \|_2^2 $ 

å…¶ä¸­ $A$ ä¸ºZernikeåŸºåº•çŸ©é˜µï¼Œ $Z$ ä¸ºZernikeå¤šé¡¹å¼å‘é‡ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢å…‰å­¦å¹²æ¶‰æµ‹é‡é¢†åŸŸçš„ç»å…¸æ–‡çŒ®ä¸å¼€æºé¡¹ç›®å¯å‘ï¼›

- æ„Ÿè°¢`numpy`ã€`scipy`ã€`matplotlib`ç­‰å¼€æºåº“æä¾›çš„åŸºç¡€æ”¯æŒã€‚

## ğŸ“ è”ç³»ä½œè€…

- GitHub: [seaton.yang](https://github.com/seatonyang)

- Email: [seaton.yang@foxmail.com](seaton.yang@foxmail.com)

---
